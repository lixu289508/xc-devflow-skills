# QA 方案变更清单（接口测试补充）

## 一、目录结构变更

**新增**：
```
test-results/{需求名}/
    └── scripts/                     # 【新增】测试脚本目录
        ├── test_xxx_api.py          # 接口测试脚本
        └── test_flow.py             # 流程测试脚本（接口串联）
```

---

## 二、新增测试类型

| 类型 | 工具 | 产出物 | 说明 |
|-----|------|--------|------|
| 接口测试 | 后端同技术栈脚本 | `scripts/test_xxx_api.py` | 单接口测试 |
| 流程测试 | 接口脚本串联 | `scripts/test_flow.py` | 业务流程走接口，不走UI |
| UI测试 | Playwright | `plan.md` | 页面交互验证（原有） |

---

## 三、新增接口测试规范

### 测试颗粒度

| 分类 | 测试点 |
|-----|-------|
| **安全** | 认证（未登录/token过期/token无效）、鉴权、越权（水平/垂直）、SQL注入、XSS、敏感数据脱敏 |
| **权限** | 角色权限、数据权限、功能权限、资源权限 |
| **参数-必填** | 未传、传空、传null |
| **参数-类型** | 类型错误、格式错误、特殊字符、空格处理、大小写 |
| **参数-长度** | 最小长度、最大长度、超长处理（⚠️低风险可截断，高风险必须拒绝） |
| **等价类** | 有效等价类、无效等价类 |
| **边界值** | 最小值、最大值、临界值±1 |
| **响应** | 状态码、错误码、返回结构、字段类型、字段值 |
| **幂等性** | 重复提交、重复请求 |
| **并发** | 并发请求、竞态条件 |
| **数据** | 数据一致性、关联数据、大数据量 |

### 测试范围策略

| 接口类型 | 测试范围 |
|---------|---------|
| 新增接口 | 全覆盖 |
| 修改接口 | 全量回归 |
| 影响接口 | 仅主流程 |

### 流程测试
- 业务流程串联：添加员工 → 分配部门 → 分配设备 → ...
- **走接口**，不走 UI（省 token）

### 脚本规范
- **技术栈**：与后端保持一致
- **一次性**：为留痕目的
- **编写时机**：阶段4

---

## 四、缓存文件新增字段

**追加到** `.claude/cache/{需求名}-context.md`：

```markdown
## 五、接口清单（阶段2追加）
- 新增接口：
- 修改接口：
- 影响接口：
```

---

## 五、流程阶段变更

### 阶段2 变更
**新增**：扫描后端代码，提取接口清单（新增/修改/影响）

### 阶段3 变更
**新增**：
- 接口测试方案：列出待测接口+测试点
- 流程测试方案：列出业务流程串联步骤
- 创建 `test-results/{需求名}/scripts/` 目录

### 阶段4 变更
**原**：编写测试计划
**改**：编写测试计划/脚本
- 接口脚本：`scripts/test_xxx_api.py`
- 流程脚本：`scripts/test_flow.py`
- UI计划：`plan.md`（原有）

### 阶段5 变更
**新增**：执行接口脚本、执行流程脚本

---

## 六、CLAUDE.md 新增内容

```markdown
## 接口测试规范
- **技术栈**：与后端保持一致
- **脚本目的**：一次性测试，为留痕
- **测试颗粒度**：安全、权限、参数、等价类、边界值、响应、幂等性、并发、数据
- **范围策略**：新增全覆盖、修改全回归、影响测主流程

## 流程测试规范
- **走接口**：业务流程串联不走 UI（省 token）
- **端到端**：确保完整业务流程通畅
```

---

## 七、SKILL.md 新增内容

**新增测试类型表格**：
```markdown
## 测试类型

| 类型 | 工具 | 产出物 |
|-----|------|--------|
| 接口测试 | 后端同技术栈脚本 | `scripts/test_xxx_api.py` |
| 流程测试 | 接口脚本串联 | `scripts/test_flow.py` |
| UI测试 | Playwright | `plan.md` |
```

**新增接口测试颗粒度**：
```markdown
## 接口测试颗粒度

| 分类 | 测试点 |
|-----|-------|
| 安全 | 认证、鉴权、越权、注入、脱敏 |
| 权限 | 角色、数据、功能、资源 |
| 参数 | 必填、类型、长度（⚠️超长：低风险截断/高风险拒绝） |
| 等价类 | 有效、无效 |
| 边界值 | 最小、最大、临界±1 |
| 响应 | 状态码、错误码、结构、字段 |
| 幂等性 | 重复提交、重复请求 |
| 并发 | 并发请求、竞态条件 |
| 数据 | 一致性、关联、大数据量 |
```

**新增测试范围策略**：
```markdown
## 测试范围策略

| 接口类型 | 测试范围 |
|---------|---------|
| 新增接口 | 全覆盖 |
| 修改接口 | 全量回归 |
| 影响接口 | 仅主流程 |
```

**相对路径新增**：
```markdown
| 测试脚本 | `test-results/{需求名}/scripts/` |
```
